---
date: 2025-10-22T15:11:00
tags:
  - C++
  - Algorithm
---

# ğŸ“ AcWingâ€”â€”ç®—æ³•åŸºç¡€è¯¾

![Language](https://img.shields.io/badge/Language-C%2B%2B-00599C?style=flat-square&logo=c%2B%2B)
![Topic](https://img.shields.io/badge/Topic-Data%20Structure-blue?style=flat-square)
![License](https://img.shields.io/badge/License-MIT-lightgrey?style=flat-square)
![Updated](https://img.shields.io/badge/Updated-2025--10--22-lightgrey?style=flat-square)

> ç¬¬äºŒè®² Â· æ•°æ®ç»“æ„ Â· é‡è¦æ¨¡æ¿ä¸é¢˜è§£

---

# ç¬¬äºŒè®² æ•°æ®ç»“æ„

## 1 å•é“¾è¡¨

### 1.1 å•é“¾è¡¨

> [!important]
>
> æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/U231659

AcWingé¢˜ç›®ï¼š

![image-20240117154736639](assets/image-20240117154736639.png)



å•é“¾è¡¨æ¨¡æ¿ï¼š

```c++
//å•é“¾è¡¨æ¨¡æ¿

int head,idx;//headæŒ‡å¤´æŒ‡é’ˆï¼ˆå¤´æŒ‡é’ˆæŒ‡å‘å¤´ç»“ç‚¹ï¼‰ï¼Œe[head]æŒ‡çš„æ˜¯å¤´ç»“ç‚¹çš„å€¼
//idxæŒ‡çš„æ˜¯ä¸‹ä¸€ä¸ªå¯å­˜å‚¨çš„ä½ç½®çš„ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ’å…¥çš„ç¬¬å‡ ä¸ªæ•°çš„åºå·ï¼Œå³idx=0æ—¶è¡¨ç¤ºæ’å…¥çš„ç¬¬ä¸€ä¸ªæ•°
 

int e[N],ne[N];//e[N]å­˜å‚¨çš„æ˜¯ç»“ç‚¹çš„å€¼ï¼Œne[N]å­˜å‚¨çš„æ˜¯ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„ç´¢å¼• 

void init(){
	head = -1;//å¤´æŒ‡é’ˆé»˜è®¤èµ‹-1 
	idx = 0;
}

void insert_to_head(int x){
	e[idx] = x;
	ne[idx] = head;
	head = idx++;
}

void remove(int k){
	ne[k] = ne[ne[k]];
}

void insert(int k ,int x){
	e[idx] = x;
	ne[idx] = ne[k];
	ne[k] = idx++;
}
```



**é¢˜è§£ä»£ç ï¼š**

```c++

//æ­¤æ¨¡æ¿çš„å…³é”®åœ¨äºk-1ç´¢å¼•ä¸Šçš„æ•°ç»å¯¹æ˜¯æ’å…¥çš„ç¬¬kä¸ªæ•° 

#include<iostream>

using namespace std;

const int N = 1e5+10;

int head,idx;//headæŒ‡å¤´æŒ‡é’ˆï¼ˆå¤´æŒ‡é’ˆæŒ‡å‘å¤´ç»“ç‚¹ï¼‰ï¼Œe[head]æŒ‡çš„æ˜¯å¤´ç»“ç‚¹çš„å€¼
//idxæŒ‡çš„æ˜¯ä¸‹ä¸€ä¸ªå¯å­˜å‚¨çš„ä½ç½®çš„ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ’å…¥çš„ç¬¬å‡ ä¸ªæ•°çš„åºå·ï¼Œå³idx=0æ—¶è¡¨ç¤ºæ’å…¥çš„ç¬¬ä¸€ä¸ªæ•°
 

int e[N],ne[N];//e[N]å­˜å‚¨çš„æ˜¯ç»“ç‚¹çš„å€¼ï¼Œne[N]å­˜å‚¨çš„æ˜¯ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹çš„ç´¢å¼• 

void init(){
	head = -1;//headçš„é»˜è®¤å€¼èµ‹-1 
	idx = 0;
}

void insert_to_head(int x){
	e[idx] = x;
	ne[idx] = head;
	head = idx++;
}

void remove(int k){
	ne[k] = ne[ne[k]];
}

void insert(int k ,int x){
	e[idx] = x;
	ne[idx] = ne[k];
	ne[k] = idx++;
}

int main(){
	int m;
	cin>>m;
	init();
	while(m--){
		char op;
		int k,x;
		cin>>op;
		if(op == 'H'){
			cin>>x;
			insert_to_head(x);
		}
		else if(op == 'I'){
			cin>>k>>x;
			insert(k-1,x);//ç¬¬kä¸ªæ’å…¥çš„æ•°ç´¢å¼•ä¸ºk-1ï¼Œå› ä¸ºidxæ˜¯ä»0å¼€å§‹çš„ï¼Œç¬¬ä¸€ä¸ªæ’å…¥çš„æ•°ç´¢å¼•ä¸º1ï¼›
		}else{
			cin>>k;
			if(!k) head = ne[head];
			else remove(k-1);
		}
	}
	
	for(int i = head ; i != -1 ; i = ne[i]) cout<<e[i]<<" ";
	cout<<endl;
	return 0;
} 

```

## 2 åŒé“¾è¡¨

### 2.1 åŒé“¾è¡¨

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/T430507



AcWingé¢˜ç›®ï¼š



![image-20240117164341619](assets/image-20240117164341619.png)





**åŒé“¾è¡¨æ¨¡æ¿ï¼š**

```c++
//åŒé“¾è¡¨æ¨¡æ¿

int l[N],r[N],e[N];
int idx;

 
void init(){
    //å¤´ç»“ç‚¹æŒ‡å‘å°¾ç»“ç‚¹ï¼Œå°¾ç»“ç‚¹æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¤´ç»“ç‚¹æŒ‡é’ˆä¸º0ï¼Œå°¾ç»“ç‚¹æŒ‡é’ˆä¸º1ï¼Œæ‰€ä»¥å¤´æŒ‡é’ˆä¸º1ï¼Œå°¾æŒ‡é’ˆä¸º0
	r[0] = 1;
	l[1] = 0;
	idx = 2; 
}

void insert(int k, int x){
	e[idx] = x;
	l[idx] = k;
	r[idx] = r[k];
	l[r[k]] = idx;//å¿…é¡»è¿™æ­¥åœ¨å‰é¢ï¼Œå¦åˆ™r[k]çš„å€¼ä¼šè¢«ä¿®æ”¹ 
	r[k] = idx++;
}

void remove(int k){
	r[l[k]] = r[k];
	l[r[k]] = l[k];
}
```



**é¢˜è§£ä»£ç ï¼š**

```c++
#include<iostream>

using namespace std;

const int N = 1e5+10;

int l[N],r[N],e[N];
int idx;

void init(){
    //å¤´ç»“ç‚¹æŒ‡å‘å°¾ç»“ç‚¹ï¼Œå°¾ç»“ç‚¹æŒ‡å‘å¤´èŠ‚ç‚¹ï¼Œå¤´ç»“ç‚¹æŒ‡é’ˆä¸º0ï¼Œå°¾ç»“ç‚¹æŒ‡é’ˆä¸º1ï¼Œæ‰€ä»¥å¤´æŒ‡é’ˆä¸º1ï¼Œå°¾æŒ‡é’ˆä¸º0
	r[0] = 1;
	l[1] = 0;
	idx = 2; 
}

void insert(int k, int x){
	e[idx] = x;
	l[idx] = k;
	r[idx] = r[k];
	l[r[k]] = idx;//å¿…é¡»è¿™æ­¥åœ¨å‰é¢ï¼Œå¦åˆ™r[k]çš„å€¼ä¼šè¢«ä¿®æ”¹ 
	r[k] = idx++;
}

void remove(int k){
	r[l[k]] = r[k];
	l[r[k]] = l[k];
}

int main(){
	int m;
	cin>>m;
	init();
	while(m--){
		string op;
		int k,x;
		cin>>op;
		if(op == "L"){
			cin>>x;
			insert(0,x);//æœ€å·¦ç«¯æ’å…¥è¡¨ç¤ºç´¢å¼•1çš„ä½ç½®æ’å…¥æ•° 
		}
		else if( op == "R"){
			cin>>x;
			insert(l[1],x);//æœ€å³ç«¯æ’å…¥è¡¨ç¤ºå°¾ç»“ç‚¹å‰é¢çš„ä½ç½®æ’å…¥æ•° 
		}
		else if( op == "D"){
			cin>>k;
			remove(k + 1);//ç¬¬kä¸ªæ’å…¥çš„æ•°ç´¢å¼•ä¸ºk+1ï¼Œå› ä¸ºidxæ˜¯ä»2å¼€å§‹çš„ï¼Œç¬¬ä¸€ä¸ªæ’å…¥çš„æ•°ç´¢å¼•ä¸º2ï¼› 
		}
		else if( op == "IL"){
			cin>>k>>x;
			insert(l[k+1],x);
		}
		else{
			cin>>k>>x;
			insert(k + 1 ,x);
		}
	}
	for(int i = r[0] ; i!= 1 ;i = r[i]) cout<<e[i]<<" ";
	cout<<endl;
	return 0; 
}
```

## 3 æ ˆ

### 3.1 æ¨¡æ‹Ÿæ ˆ

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/B3614



AcWingé¢˜ç›®ï¼š



![image-20240118094554429](assets/image-20240118094554429.png)



**æ ˆæ¨¡æ¿ï¼š**

```c++
//æ ˆæ¨¡æ¿
// topè¡¨ç¤ºæ ˆé¡¶
int stk[N], top = -1;

// å‘æ ˆé¡¶æ’å…¥ä¸€ä¸ªæ•°
stk[ ++ top] = x;

// ä»æ ˆé¡¶å¼¹å‡ºä¸€ä¸ªæ•°
top -- ;

// æ ˆé¡¶çš„å€¼
stk[top];

// åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœ top >= 0ï¼Œåˆ™è¡¨ç¤ºä¸ä¸ºç©º
if (top >= 0)
{

}
```

**é¢˜è§£ä»£ç ï¼š**

```c++
#include<iostream>

using namespace std;

const int N = 100010;

int top = -1;//åˆå§‹æ—¶topç­‰äº-1ï¼Œè¡¨ç¤ºæ²¡æœ‰å…ƒç´ 
int stk[N];

int main(){
	int m;
	cin>>m;
	while(m--){
		string s;
		int x;
		cin>>s;
		if(s == "push"){
			cin>>x;
			stk[++top] = x;
		}
		else if(s == "pop") top--;
		else if(s == "empty"){
			if(top >= 0) cout<<"NO"<<endl;
			else cout<<"YES"<<endl; 
		}
		else cout<<stk[top]<<endl;
	}
	return 0;
} 

```

### 3.2 è¡¨è¾¾å¼æ±‚å€¼

![image-20240118101220859](assets/image-20240118101220859.png)

```c++
#include <iostream>
#include <stack>
#include <string>
#include <map>
using namespace std;

//åŒæ ˆåŠ ä¼˜å…ˆçº§è¡¨ 
stack<int> num;
stack<char> op;
map<char, int> h = { {'+', 1}, {'-', 1}, {'*',2}, {'/', 2} };

//æ±‚å€¼å‡½æ•° 
void eval()
{
    int b = num.top();//ç¬¬äºŒä¸ªæ“ä½œæ•°
    num.pop();

    int a = num.top();//ç¬¬ä¸€ä¸ªæ“ä½œæ•°
    num.pop();

    char p = op.top();//è¿ç®—ç¬¦
    op.pop();

    int r = 0;//ç»“æœ 

    //è®¡ç®—ç»“æœ
    if (p == '+') r = a + b;
    else if (p == '-') r = a - b;
    else if (p == '*') r = a * b;
    else if (p == '/') r = a / b;

    num.push(r);//ç»“æœå…¥æ ˆ
}

int main()
{
    string s;//è¯»å…¥è¡¨è¾¾å¼
    cin >> s;

    for (int i = 0; i < s.size(); i++)
    {
    	char c = s[i]; 
    	//1.æ•°å­—ï¼Œæ•°å­—å…¥æ ˆ 
        if (isdigit(c))
        {	
        	//æ­¤whileå¾ªç¯æ˜¯åœ¨è¯»åˆ°äº†æ•°å­—æ—¶è¯»å®Œä¸€æ•´ä¸ªæ•°å­— 
            int x = 0, j = i;
            while (j < s.size() && isdigit(s[j]))
            {
                x = x * 10 + s[j] - '0';
                j++;
            }
            num.push(x);
            i = j - 1;
        }
        //2.å·¦æ‹¬å·ï¼Œå·¦æ‹¬å·æ— ä¼˜å…ˆçº§ï¼Œç›´æ¥å…¥æ ˆ
        else if (c == '(')//å·¦æ‹¬å·å…¥æ ˆ
        {
            op.push(c);
        }
        //3.å³æ‹¬å·ï¼Œæ‹¬å·ç‰¹æ®Šï¼Œé‡åˆ°å·¦æ‹¬å·ç›´æ¥å…¥æ ˆï¼Œé‡åˆ°å³æ‹¬å·ä¸è¿›æ ˆï¼Œç›´æ¥è®¡ç®— 
        else if (c == ')')
        {
            while(op.top() != '(')
                eval();
            op.pop();//å·¦æ‹¬å·å‡ºæ ˆ
        }
        //4.è¿ç®—ç¬¦ï¼Œä¸»è¦æ˜¯ä¼˜å…ˆçº§çš„é—®é¢˜ 
        else
        {
            while (op.size() && h[op.top()] >= h[c])//å¾…å…¥æ ˆè¿ç®—ç¬¦ä¼˜å…ˆçº§ä½ï¼Œåˆ™å…ˆè®¡ç®—
                eval();
            op.push(c);//ç®—å®Œä¹‹åæ­¤è¿ç®—ç¬¦å…¥æ ˆ
        }
    }
    while (op.size()) eval();//å‰©ä½™çš„è¿›è¡Œè®¡ç®— 
    cout << num.top() << endl;//è¾“å‡ºç»“æœ
    return 0;
}
```

## 4 é˜Ÿåˆ—

### 4.1 æ¨¡æ‹Ÿé˜Ÿåˆ—

æ´›è°·ï¼š

https://www.luogu.com.cn/problem/B3616



AcWingé¢˜ç›®ï¼š



![image-20240120102239602](assets/image-20240120102239602.png)



**æ¨¡æ‹Ÿæ™®é€šé˜Ÿåˆ—æ¨¡æ¿ï¼š**

```c++
//æ¨¡æ‹Ÿæ™®é€šé˜Ÿåˆ—æ¨¡æ¿

// hh è¡¨ç¤ºé˜Ÿå¤´ï¼Œttè¡¨ç¤ºé˜Ÿå°¾
int q[N], hh = 0, tt = -1;

// å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªæ•°
q[ ++ tt] = x;

// ä»é˜Ÿå¤´å¼¹å‡ºä¸€ä¸ªæ•°
hh ++ ;

// é˜Ÿå¤´çš„å€¼
q[hh];

// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœ tt >= hhï¼Œåˆ™è¡¨ç¤ºä¸ä¸ºç©º
if (tt >= hh)
{

}

//æ¨¡æ‹Ÿå¾ªç¯é˜Ÿåˆ—æ¨¡æ¿

// hh è¡¨ç¤ºé˜Ÿå¤´ï¼Œttè¡¨ç¤ºé˜Ÿå°¾çš„åä¸€ä¸ªä½ç½®
int q[N], hh = 0, tt = 0;

// å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªæ•°
q[tt ++ ] = x;
if (tt == N) tt = 0;

// ä»é˜Ÿå¤´å¼¹å‡ºä¸€ä¸ªæ•°
hh ++ ;
if (hh == N) hh = 0;

// é˜Ÿå¤´çš„å€¼
q[hh];

// åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœhh != ttï¼Œåˆ™è¡¨ç¤ºä¸ä¸ºç©º(å…¶å®ä¸èƒ½è¿™æ ·ç®€å•åˆ¤æ–­æ˜¯å¦ä¸ºç©º)
if (hh != tt)
{

}
```



**é¢˜è§£ä»£ç ï¼š**

```c++
#include <iostream>
using namespace std;
const int N = 100010;
int q[N];

//[hh, tt] ä¹‹é—´ä¸ºé˜Ÿåˆ—ï¼ˆå·¦é—­å³é—­ï¼‰
int hh = 0;//é˜Ÿå¤´ä½ç½®
int tt = -1;//é˜Ÿå°¾ä½ç½®ï¼Œå­˜ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶çš„ç´¢å¼•ä¸º0ï¼Œæ‰€ä»¥ä»0å¼€å§‹å­˜å‚¨ 
int m;
string s;


int main(){
    cin >> m;
    while(m--){
        cin >> s;
        //å…¥é˜Ÿ
        if(s == "push"){
            int x;
            cin >> x;
            q[++tt] = x;
        }
        //å‡ºé˜Ÿ
        else if(s == "pop"){
            hh++;
        }
        //é—®ç©º
        else if(s == "empty"){
            if(tt >= hh) cout << "NO" << endl;
    		else cout << "YES" << endl;
        }
        //æŸ¥è¯¢ 
        else if(s == "query"){
            cout << q[hh] << endl;
        }
    }
}

```

## 5 å•è°ƒæ ˆ

### 5.1 å•è°ƒæ ˆ

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/P5788

AcWingé¢˜ç›®ï¼š



![image-20240120170024084](assets/image-20240120170024084.png)



**å•è°ƒæ ˆå¸¸è§æ¨¡å‹ï¼š**

```c++
//å•è°ƒæ ˆå¸¸è§æ¨¡å‹ï¼šæ‰¾å‡ºæ¯ä¸ªæ•°å·¦è¾¹ç¦»å®ƒæœ€è¿‘çš„æ¯”å®ƒå¤§/å°çš„æ•°
int top = -1;
while(n--)
{
    while (top >= 0 && check(stk[top], x)) top -- ;
    stk[ ++ top] = x;
}
```

**é¢˜è§£ä»£ç ï¼š**

```c++
#include <iostream>

using namespace std;

const int N = 100010;

int stk[N];
int top = -1;

int main(){
	int n;
	cin>>n;
	while(n--){
		int x;
		cin>>x;
		while(top >= 0 && stk[top] >= x) top--;//æ¯”xå¤§çš„å…ƒç´ å…¨å¼¹å‡ºæ¥ 
		if(top >= 0) cout<<stk[top]<<" ";//å¼¹å®Œä¹‹åå¦‚æœè¿˜æœ‰å…ƒç´ å°±è¾“å‡ºæ ˆé¡¶å…ƒç´  
		else cout<<-1<<" ";//æ— å°±è¾“å‡º-1 
		stk[++top] = x;//æœ€åè¦æŠŠxå­˜å…¥ï¼Œå› ä¸ºxæ˜¯æœ‰å¯èƒ½æ¯”ä¹‹åçš„å…ƒç´ å°çš„ï¼Œå¹¶ä¸”xç¦»ä¹‹åçš„å…ƒç´ æœ€è¿‘ 
	}
	return 0;
}
```

## 6 å•è°ƒé˜Ÿåˆ—

### 6.1 æ»‘åŠ¨çª—å£

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/P1886



AcWingé¢˜ç›®ï¼š



![image-20240120203412724](assets/image-20240120203412724.png)



**å•è°ƒé˜Ÿåˆ—å¸¸è§æ¨¡å‹ï¼š**

```c++
//å•è°ƒé˜Ÿåˆ—å¸¸è§æ¨¡å‹ï¼šæ‰¾å‡ºæ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼/æœ€å°å€¼
int hh = 0, tt = -1;
for (int i = 0; i < n; i ++ )
{
    while (hh <= tt && check_out(q[hh])) hh ++ ;  // åˆ¤æ–­é˜Ÿå¤´æ˜¯å¦æ»‘å‡ºçª—å£
    while (hh <= tt && check(q[tt], i)) tt -- ;
    q[ ++ tt] = i;
}
```

**é¢˜è§£ä»£ç ï¼š**

```c++
#include <iostream>

using namespace std;

const int N = 1000010;

int a[N],q[N];//q[N]å­˜çš„æ˜¯ä¸‹æ ‡ 

int main(){
	int n,k;
	cin>>n>>k;
	for(int i = 0; i< n ; i++) cin>>a[i];
	
	//æœ€å°å€¼ 
	int hh = 0, tt = -1;
	for(int i = 0 ; i < n; i++){
		//æ»‘å‡ºé˜Ÿå¤´ 
		if(hh <= tt && q[hh] < i-k+1) hh++;//i-k+1ä¸ºçª—å£çš„æœ€å·¦ç«¯ç´¢å¼•
		//å»æ‰æ¯”å½“å‰è¦è¿›å…¥çš„æ•°æ›´å¤§çš„æ•° 
		while(hh <= tt && a[q[tt]] >= a[i]) tt--;
		//å½“å‰æ“ä½œæ•°çš„ç´¢å¼•å­˜å…¥æ•°ç»„ 
		q[++tt] = i;
		// i ç­‰äº k - 1 æ—¶ï¼Œçª—å£çš„å¤§å°åˆšå¥½ä¸º kã€‚å› æ­¤ï¼Œå½“ i å¤§äºæˆ–ç­‰äº k - 1 æ—¶ï¼Œçª—å£å°±å·²ç»åŒ…å«äº†è‡³å°‘ k ä¸ªå…ƒç´ ã€‚
		if(i >= k-1) cout<<a[q[hh]]<<" ";
	}
	cout<<endl;
	
	//æœ€å¤§å€¼ï¼Œé™¤a[q[tt]] <= a[i]å¤–æ— å˜åŒ– 
	hh = 0, tt = -1;
	for(int i = 0 ; i < n; i++){
		if(hh <= tt && q[hh] < i-k+1) hh++;
		while(hh <= tt && a[q[tt]] <= a[i]) tt--;
		q[++tt] = i;
		if(i >= k-1) cout<<a[q[hh]]<<" ";
	}
	cout<<endl;
	return 0;
}
```

## 7 KMP

### 7.1 KMPå­—ç¬¦ä¸²

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/P3375



AcWingé¢˜ç›®ï¼š



![image-20240122110906061](assets/image-20240122110906061.png)



æ‰‹åŠ¨æ¨¡æ‹Ÿæ±‚nextæ•°ç»„ï¼š

å¯¹ p = â€œabcabâ€

|   p    |  a   |  b   |  c   |  a   |  b   |
| :----: | :--: | :--: | :--: | :--: | :--: |
|  ä¸‹æ ‡  |  1   |  2   |  3   |  4   |  5   |
| next[] |  0   |  0   |  0   |  1   |  2   |

å¯¹next[ 1 ] ï¼šå‰ç¼€ = ç©ºé›†â€”â€”â€”â€”â€”åç¼€ = ç©ºé›†â€”â€”â€”â€”â€”next[ 1 ] = 0;

å¯¹next[ 2 ] ï¼šå‰ç¼€ = { a }â€”â€”â€”â€”â€”åç¼€ = { b }â€”â€”â€”â€”â€”next[ 2 ] = 0;

å¯¹next[ 3 ] ï¼šå‰ç¼€ = { a , ab }â€”â€”â€”â€”â€”åç¼€ = { c , bc}â€”â€”â€”â€”â€”next[ 3 ] = 0;

å¯¹next[ 4 ] ï¼šå‰ç¼€ = { **a** , ab , abc }â€”â€”â€”â€”â€”åç¼€ = { **a** . ca , bca }â€”â€”â€”â€”â€”next[ 4 ] = 1;

å¯¹next[ 5 ] ï¼šå‰ç¼€ = { a , **ab** , abc , abca }â€”â€”â€”â€”åç¼€ = { b , **ab** , cab , bcab}â€”â€”â€”â€”next[ 5 ] = 2;



![image-20240122173501859](assets/image-20240122173501859.png)

```c++
// s[]æ˜¯é•¿æ–‡æœ¬ï¼Œp[]æ˜¯æ¨¡å¼ä¸²ï¼Œmæ˜¯sçš„é•¿åº¦ï¼Œnæ˜¯pçš„é•¿åº¦
//æ±‚æ¨¡å¼ä¸²çš„Nextæ•°ç»„ï¼š
for (int i = 2, j = 0; i <= n; i ++ )
{	
    while (j && p[i] != p[j + 1]) j = ne[j];
    if (p[i] == p[j + 1]) j ++ ;
    ne[i] = j;
}

// åŒ¹é…
for (int i = 1, j = 0; i <= m; i ++ )
{
    while (j && s[i] != p[j + 1]) j = ne[j];
    if (s[i] == p[j + 1]) j ++ ;
    if (j == n)
    {
        j = ne[j];
        // åŒ¹é…æˆåŠŸåçš„é€»è¾‘
    }
}
```



```c++
//KMPç®—æ³•å³å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•
#include <iostream>

using namespace std;

const int N = 10010, M = 100010;

//pï¼Œsï¼Œneæ•°ç»„ç´¢å¼•éƒ½æ˜¯ä»1å¼€å§‹çš„ 
char p[N],s[M];
int ne[N];

int main(){                   
	int n,m;
	cin>>n>>p+1>>m>>s+1;
	
//	//è¾“å‡ºä¸ºç©º 
//	cout<<p<<endl;
//	cout<<s<<endl;
//	
//	//è¾“å‡ºæ•´ä¸ªpå’Œæ•´ä¸ªs 
//	cout<<p+1<<endl;
//	cout<<s+1<<endl;
	
	//æ±‚neæ•°ç»„çš„è¿‡ç¨‹,ne[1]ä¸º0ï¼Œæ‰€ä»¥ä»2å¼€å§‹ï¼Œne[i]è¡¨ç¤ºä»1åˆ°iä¹‹é—´ï¼Œå‰ç¼€å’Œåç¼€æœ€é•¿ç›¸ç­‰å…ƒç´ çš„é•¿åº¦
	//nextæ•°ç»„çš„æ±‚æ³•æ˜¯æ¨¡æ¿ä¸²è‡ªå·±ä¸è‡ªå·±è¿›è¡ŒåŒ¹é… 
	for(int i = 2, j = 0; i <= n; i++){
        //å¦‚æœä¸ç­‰å°±å›æº¯
		while(j && p[i] != p[j+1]) j = ne[j];
        //å¦‚æœç›¸ç­‰ï¼Œæ¨¡æ¿ä¸²ä¸‹æ ‡jçš„å…ƒç´ æ˜¯æå‰å’Œæ–‡æœ¬ä¸²å¯¹åº”jçš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸ºiçš„å…ƒç´ æ¯”è¾ƒï¼Œæ‰€ä»¥jè¦+1
		if(p[i] == p[j+1]) j++;
        //ç°åœ¨jå°±å·²ç»æ˜¯å‰ç¼€å’Œåç¼€æœ€é•¿ç›¸ç­‰å…ƒç´ çš„é•¿åº¦ï¼Œæ‰€ä»¥è¦èµ‹ç»™ne[i]
		ne[i] = j;
	}
	
	//kmpåŒ¹é…è¿‡ç¨‹ï¼Œæ¨¡æ¿ä¸²ä¸æ–‡æœ¬ä¸²è¿›è¡ŒåŒ¹é… 
	for(int i = 1, j = 0; i <= m; i++){
        //å¦‚æœä¸ç­‰å°±å›æº¯
		while(j && s[i] != p[j+1]) j = ne[j];
        //å¦‚æœç›¸ç­‰ï¼Œæ¨¡æ¿ä¸²ä¸‹æ ‡jçš„å…ƒç´ æ˜¯æå‰å’Œæ–‡æœ¬ä¸²å¯¹åº”jçš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¹Ÿå°±æ˜¯ä¸‹æ ‡ä¸ºiçš„å…ƒç´ æ¯”è¾ƒï¼Œæ‰€ä»¥jè¦+1ï¼ˆçŸ­çš„ä¸ºæ¨¡æ¿ä¸²ï¼‰
		if(s[i] == p[j+1]) j++;
        //j == næ˜¯æ‰¾åˆ°äº†å®Œæ•´çš„ç›¸åŒçš„å­—ç¬¦ä¸²
		if(j == n){
			cout<<i-n<<" ";//è¾“å…¥åŒ¹é…å®Œå…¨çš„å­—ç¬¦ä¸²çš„å¤´ä¸‹æ ‡ï¼Œé¢˜ç›®ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼Œæ‰€ä»¥ä¸ç”¨åŠ ä¸€ 
			j = ne[j];//ç»§ç»­å›æº¯æ‰¾ä¸‹ä¸€ä¸ªç›¸åŒçš„å­—ç¬¦ä¸²ï¼Œä¸è¦ä»å¤´å¼€å§‹
		}
	}
	return 0; 
}
```

## 8 Trie æ ‘

### 8.1 Trieå­—ç¬¦ä¸²ç»Ÿè®¡

> [!important]
>
> ç‰›å®¢ï¼š
>
> [ã€æ¨¡æ¿ã€‘Trie å­—å…¸æ ‘_ç‰›å®¢é¢˜éœ¸_ç‰›å®¢ç½‘](https://www.nowcoder.com/practice/feed1cd7546a4901965751b9fbf5f8a1)
>
> æ´›è°·ï¼š
>
> https://www.luogu.com.cn/problem/P8306

AcWingé¢˜ç›®ï¼š



![image-20240123153627492](assets/image-20240123153627492.png)

![image-20240123170847767](assets/image-20240123170847767.png)

![image-20240123155741555](assets/image-20240123155741555.png)



```c++
int son[N][26], cnt[N], idx;
// 0å·ç‚¹æ—¢æ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆæ˜¯ç©ºèŠ‚ç‚¹
// son[][]å­˜å‚¨æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹
// cnt[]å­˜å‚¨ä»¥æ¯ä¸ªèŠ‚ç‚¹ç»“å°¾çš„å­—ç¬¦ä¸²æ•°é‡

// æ’å…¥ä¸€ä¸ªå­—ç¬¦ä¸²
void insert(char *str)
{
    int p = 0;
    for (int i = 0; str[i]; i ++ )
    {
        int u = str[i] - 'a';
        if (!son[p][u]) son[p][u] = ++ idx;
        p = son[p][u];
    }
    cnt[p] ++ ;
}

// æŸ¥è¯¢å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°
int query(char *str)
{
    int p = 0;
    for (int i = 0; str[i]; i ++ )
    {
        int u = str[i] - 'a';
        if (!son[p][u]) return 0;
        p = son[p][u];
    }
    return cnt[p];
```



```c++
//Trieæ ‘å¿«é€Ÿå­˜å‚¨å­—ç¬¦é›†åˆå’Œå¿«é€ŸæŸ¥è¯¢å­—ç¬¦é›†åˆ
#include <iostream>

using namespace std;

const int N = 100010;
//son[][]å­˜å‚¨å­èŠ‚ç‚¹çš„ä½ç½®ï¼Œä¹Ÿå­˜å‚¨ç¬¬å‡ ä¸ªç»“ç‚¹ï¼ˆidxçš„å€¼ï¼‰ï¼Œåˆ†æ”¯æœ€å¤š26æ¡ï¼›
//cnt[p]å­˜å‚¨ä»¥pèŠ‚ç‚¹ç»“å°¾çš„å­—ç¬¦ä¸²ä¸ªæ•°ï¼ˆåŒæ—¶ä¹Ÿèµ·æ ‡è®°ä½œç”¨ï¼‰
//idxè¡¨ç¤ºå½“å‰è¦æ’å…¥çš„èŠ‚ç‚¹æ˜¯ç¬¬å‡ ä¸ª,æ¯åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹å€¼+1
int son[N][26], cnt[N], idx;
char str[N];

void insert(char *str)
{
    int p = 0;  //ç±»ä¼¼æŒ‡é’ˆï¼ŒæŒ‡å‘å½“å‰èŠ‚ç‚¹
    for(int i = 0; str[i]; i++)
    {
        int u = str[i] - 'a'; //å°†å­—æ¯è½¬åŒ–ä¸ºæ•°å­—
        if(!son[p][u]) son[p][u] = ++idx;   //è¯¥èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ›å»ºèŠ‚ç‚¹
        p = son[p][u];  //ä½¿â€œpæŒ‡é’ˆâ€æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    }
    cnt[p]++;  //ç»“æŸæ—¶çš„æ ‡è®°ï¼Œä¹Ÿæ˜¯è®°å½•ä»¥æ­¤èŠ‚ç‚¹ç»“æŸçš„å­—ç¬¦ä¸²ä¸ªæ•°
}

int query(char *str)
{
    int p = 0;
    for(int i = 0; str[i]; i++)
    {
        int u = str[i] - 'a';
        if(!son[p][u]) return 0;  //è¯¥èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œå³è¯¥å­—ç¬¦ä¸²ä¸å­˜åœ¨
        p = son[p][u]; 
    }
    return cnt[p];  //è¿”å›å­—ç¬¦ä¸²å‡ºç°çš„æ¬¡æ•°
}

int main()
{
    int m;
    cin >> m;

    while(m--)
    {
        char op[2];
		cin>>op>>str; 
        if(*op == 'I') insert(str);
        else cout<<query(str)<<endl;
        //æ”¹æˆchar op; op == 'I'ä¹Ÿè¡Œ
    }

    return 0;
}
```

### 8.2 æœ€å¤§å¼‚æˆ–å¯¹

![image-20240123170151813](assets/image-20240123170151813.png)

```c++
#include<iostream>
#include<algorithm>
using namespace std;
const int N=100010,M=31*N;

int a[N];
int son[M][2],idx;
//Mä»£è¡¨ä¸€ä¸ªæ•°å­—ä¸²äºŒè¿›åˆ¶å¯ä»¥åˆ°å¤šé•¿

void insert(int x)
{
    int p=0;  //æ ¹èŠ‚ç‚¹
    for(int i=30;i>=0;i--)
    {
        int u=x>>i&1;   //å–xçš„äºŒè¿›åˆ¶ä¸­çš„ç¬¬iä½æ•°å­—
        if(!son[p][u]) son[p][u]=++idx; ///å¦‚æœæ’å…¥ä¸­å‘ç°æ²¡æœ‰è¯¥å­èŠ‚ç‚¹,å¼€å‡ºè¿™æ¡è·¯
        p=son[p][u]; //æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€å±‚
    }
}
//å¼‚æˆ–è¿ç®—ç›¸åŒä¸º0ä¸åŒä¸º1 
int search(int x)
{
    int p=0;int res=0;
    for(int i=30;i>=0;i--)
    {                               
        int u=x>>i&1; //ä»æœ€å¤§ä½å¼€å§‹æ‰¾
        if(son[p][!u]) //å¦‚æœå½“å‰å±‚æœ‰å¯¹åº”çš„ä¸ç›¸åŒçš„æ•°ï¼Œreså·¦ç§»ä¸€ä½å¹¶åŠ ä¸€ 
        {   
          p=son[p][!u];
          res=res*2+1;
             //*2ç›¸å½“å·¦ç§»ä¸€ä½  ç„¶åå¦‚æœæ‰¾åˆ°å¯¹åº”ä½ä¸Šä¸åŒçš„æ•°res+1
        }                                                       
        else //å¦‚æœå½“å‰å±‚æœ‰å¯¹åº”çš„ç›¸åŒçš„æ•°ï¼Œreså·¦ç§»ä¸€ä½å¹¶åŠ é›¶                                                                                                                    //åˆšå¼€å§‹æ‰¾0çš„æ—¶å€™æ˜¯ä¸€æ ·çš„æ‰€ä»¥+0    åˆ°äº†0å’Œ1çš„æ—¶å€™åŸæ¥0å³ç§»ä¸€ä½,åˆ¤æ–­å½“å‰ä½æ˜¯åŒè¿˜æ˜¯å¼‚,åŒ+0,å¼‚+1
        {
            p=son[p][u];
            res=res*2+0;
        }
    }
    return res;
}
int main()
{
	int n; 
    cin>>n;
    for(int i=0;i<n;i++)
    {
        cin>>a[i];
        insert(a[i]);
    }
    int res=0;
    for(int i=0;i<n;i++)
    {   
        res=max(res,search(a[i]));  ///search(a[i])æŸ¥æ‰¾çš„æ˜¯a[i]å€¼çš„æœ€å¤§ä¸æˆ–å€¼
    }
    cout<<res<<endl;
    return 0; 
}
```

## 9 å¹¶æŸ¥é›†

```c++

å¹¶æŸ¥é›†ï¼š
1.å°†ä¸¤ä¸ªé›†åˆåˆå¹¶
2.è¯¢é—®ä¸¤ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆå½“ä¸­
åŸºæœ¬åŸç†ï¼šæ¯ä¸ªé›†åˆç”¨ä¸€æ£µæ ‘æ¥è¡¨ç¤ºã€‚æ ‘æ ¹çš„ç¼–å·å°±æ˜¯æ•´ä¸ªé›†åˆçš„ç¼–å·ã€‚æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨
å®ƒçš„çˆ¶èŠ‚ç‚¹ï¼Œp[x]è¡¨ç¤ºxçš„çˆ¶èŠ‚ç‚¹
é—®é¢˜1ï¼šå¦‚ä½•åˆ¤æ–­æ ‘æ ¹ï¼šif(p[x]==x)
é—®é¢˜2ï¼šå¦‚ä½•æ±‚xçš„é›†åˆç¼–å·ï¼šwhile(p[x]!=x)x = p[x]
é—®é¢˜3ï¼šå¦‚ä½•åˆå¹¶ä¸¤ä¸ªé›†åˆï¼špxæ˜¯xçš„é›†åˆç¼–å·ï¼Œpyæ˜¯yçš„é›†åˆç¼–å·ã€‚p[x]=y

(1)æœ´ç´ å¹¶æŸ¥é›†ï¼š

    int p[N]; //å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x) p[x] = find(p[x]);
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ ) p[i] = i;

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    p[find(a)] = find(b);


(2)ç»´æŠ¤sizeçš„å¹¶æŸ¥é›†ï¼š

    int p[N], size[N];
    //p[]å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹, size[]åªæœ‰ç¥–å®—èŠ‚ç‚¹çš„æœ‰æ„ä¹‰ï¼Œè¡¨ç¤ºç¥–å®—èŠ‚ç‚¹æ‰€åœ¨é›†åˆä¸­çš„ç‚¹çš„æ•°é‡

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x) p[x] = find(p[x]);
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ )
    {
        p[i] = i;
        size[i] = 1;
    }

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    size[find(b)] += size[find(a)];
    p[find(a)] = find(b);


(3)ç»´æŠ¤åˆ°ç¥–å®—èŠ‚ç‚¹è·ç¦»çš„å¹¶æŸ¥é›†ï¼š

    int p[N], d[N];
    //p[]å­˜å‚¨æ¯ä¸ªç‚¹çš„ç¥–å®—èŠ‚ç‚¹, d[x]å­˜å‚¨xåˆ°p[x]çš„è·ç¦»

    // è¿”å›xçš„ç¥–å®—èŠ‚ç‚¹
    int find(int x)
    {
        if (p[x] != x)
        {
            int u = find(p[x]);
            d[x] += d[p[x]];
            p[x] = u;
        }
        return p[x];
    }

    // åˆå§‹åŒ–ï¼Œå‡å®šèŠ‚ç‚¹ç¼–å·æ˜¯1~n
    for (int i = 1; i <= n; i ++ )
    {
        p[i] = i;
        d[i] = 0;
    }

    // åˆå¹¶aå’Œbæ‰€åœ¨çš„ä¸¤ä¸ªé›†åˆï¼š
    p[find(a)] = find(b);
    d[find(a)] = distance; // æ ¹æ®å…·ä½“é—®é¢˜ï¼Œåˆå§‹åŒ–find(a)çš„åç§»é‡
```



### 9.1 åˆå¹¶é›†åˆ

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/P3367



AcWingé¢˜ç›®ï¼š



![image-20240124160753483](assets/image-20240124160753483.png)

![image-20240124171038450](assets/image-20240124171038450.png)

```c++
#include<iostream>

using namespace std;

const int N=100010;
int p[N];//å­˜å‚¨çˆ¶èŠ‚ç‚¹çš„æ•°ç»„ï¼Œp[x]=yè¡¨ç¤ºxçš„çˆ¶èŠ‚ç‚¹ä¸ºy 

//æ‰¾æ ¹èŠ‚ç‚¹ï¼ˆé›†åˆç¼–å·ï¼‰çš„å‡½æ•° ï¼ŒæŸ¥æ‰¾è¿‡ä¸€éåæ‰€æœ‰ç»è¿‡çš„xçš„çˆ¶èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹éƒ½ä¼šå˜ä¸ºé›†åˆç¼–å·ä»¥é™ä½æ—¶é—´å¤æ‚åº¦ 
int find(int x)
{
    if(p[x]!=x) p[x]=find(p[x]);//åªæœ‰æ ¹èŠ‚ç‚¹çš„p[x]=xï¼Œæ‰€ä»¥è¦ä¸€ç›´æ‰¾ç›´åˆ°æ‰¾åˆ°æ ¹èŠ‚ç‚¹ 
    return p[x];//æ‰¾åˆ°äº†ä¾¿è¿”å›æ ¹èŠ‚ç‚¹çš„å€¼
}

int main()
{
    int n,m;
    cin>>n>>m;
    for(int i=1;i<=n;i++) p[i]=i;//åˆšå¼€å§‹æ¯ä¸ªæ•°è‡ªæˆä¸€ä¸ªé›†åˆï¼Œæ¯ä¸ªæ•°è‡ªå·±ä¸ºæ ¹èŠ‚ç‚¹ 
    while(m--)
    {
        char op;
        int a,b;
        cin>>op>>a>>b;
        if(op=='M') p[find(a)]=find(b);//é›†åˆåˆå¹¶æ“ä½œ(æŠŠaåˆå¹¶åˆ°bé›†åˆ)
        else{
        	if(find(a)==find(b)) cout<<"Yes"<<endl;//å¦‚æœæ ¹èŠ‚ç‚¹ä¸€æ ·,å°±è¾“å‡ºyes
	        else cout<<"No"<<endl;
		}
    }
    return 0;
}
```

### 9.2 è¿é€šå—ä¸­ç‚¹çš„æ•°é‡

![image-20240125093449764](assets/image-20240125093449764.png)

```c++
#include <iostream>

using namespace std;

const int N = 100010;

//åªæœ‰æ ¹èŠ‚ç‚¹çš„sèƒ½ä»£è¡¨é›†åˆçš„èŠ‚ç‚¹æ•°é‡ï¼Œæ‰€ä»¥sä¸­æ‹¬å·é‡Œä¸€èˆ¬éƒ½è¦æœ‰findå‡½æ•°å…ˆæ‰¾å‡ºæ ¹èŠ‚ç‚¹ 
int p[N],s[N];

int find(int x){
	if(p[x] != x) p[x] = find(p[x]);
	return p[x];
}

int main(){
	int n,m;
	cin>>n>>m;
	for(int i = 1; i <= n;i++){
		p[i] = i;
		s[i] = 1;
	}
	while(m--){
		string op;
		int a,b;
		cin>>op;
		if(op == "C"){
			cin>>a>>b;
			if(find(a) == find(b)) continue;
			s[find(b)]+=s[find(a)];//å…ˆåŠ size 
			p[find(a)] = find(b);//å†è¿	
		}
		else if(op == "Q1"){
			cin>>a>>b;
			if(find(a) == find(b)) cout<<"Yes"<<endl;
			else cout<<"No"<<endl;
		}
		else{
			cin>>a;
			cout<<s[find(a)]<<endl;
		}
	}
	return 0;
}
```

### 9.3 é£Ÿç‰©é“¾

![image-20240125102343329](assets/image-20240125102343329.png)

![image-20240125153340738](assets/image-20240125153340738.png)

![image-20240125163650313](assets/image-20240125163650313.png)

```c++
#include <iostream>

using namespace std;

const int N = 50010;

//d[x]è¡¨ç¤ºxåˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»ï¼Œp[x]è¡¨ç¤ºxçš„çˆ¶èŠ‚ç‚¹ 
int p[N],d[N];

/*int find(int x)å‡½æ•°ä¸¤ä¸ªä½œä½œç”¨ï¼š
1.ä½¿æ ¹èŠ‚ç‚¹æˆä¸ºxçš„çˆ¶èŠ‚ç‚¹ï¼Œå¹¶è¿”å›xçš„æ ¹èŠ‚ç‚¹
2.å°†d[x]å³xåˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»å˜ä¸ºxåˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»*/
int find(int x){
	if(p[x]!=x){
		int t = find(p[x]);
		//findå®Œä¹‹åï¼Œp[x]ç›´æ¥è¿æ¥æ ¹èŠ‚ç‚¹äº†ï¼Œd[p[x]]æ˜¯xçš„çˆ¶èŠ‚ç‚¹p[x]åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»ï¼Œå³ï¼š
		/*xåˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦» = xåˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦» + çˆ¶èŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»
		d[x] = d[x] + d[p[x]];*/ 
		//å¦‚æœä¸å…ˆfindé‚£ä¹ˆd[p[x]]å°±æ˜¯xçš„çˆ¶èŠ‚ç‚¹p[x]åˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»ï¼Œå°±ä¸ä¸€å®šæ˜¯p[x]åˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦»ï¼Œå³ï¼š 
		/*xåˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦» = xåˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦» + çˆ¶èŠ‚ç‚¹åˆ°çˆ¶èŠ‚ç‚¹çš„è·ç¦»
		d[x] = d[x] + d[p[x]];*/ 
		//å› ä¸ºfindå®Œä¹‹åp[x]çš„å­èŠ‚ç‚¹å°±æ˜¯xï¼Œçˆ¶èŠ‚ç‚¹å°±æ˜¯æ ¹èŠ‚ç‚¹0 
		d[x] += d[p[x]];//è¿™æ­¥è¿›è¡Œå®Œd[x]æ˜¯æ²¡é”™çš„äº†ï¼Œå°±æ˜¯xåˆ°æ ¹èŠ‚ç‚¹çš„æ€»è·ç¦»
		//è¿™æ­¥å†æŠŠxçš„çˆ¶èŠ‚ç‚¹æ”¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå–ä»£ä¹‹å‰xå’Œæ ¹èŠ‚ç‚¹ä¹‹é—´çš„çˆ¶èŠ‚ç‚¹ï¼Œè¿™æ ·xå’Œæ ¹èŠ‚ç‚¹å°±æ˜¯è·ç¦»ä¹Ÿæ²¡é”™ä¹Ÿæ˜¯ç›´æ¥è¿æ¥çš„äº†  
		p[x] = t; 
	}
	return p[x];
}

int main(){
	int n,m;
	cin>>n>>m;
	for(int i = 1; i<= n; i++) p[i] = i;
	int res = 0;
	while(m--){
		int t,x,y;
		cin>>t>>x>>y;
		//1.Xæˆ–Yæ¯”Nå¤§ï¼Œå‡è¯
		if( x>n || y>n) res++;
		else{
			//ä¸ºä»€ä¹ˆpxä¸€å®šè¦ç­‰äºpyä¹Ÿå°±æ˜¯xå’Œyä¸ºä»€ä¹ˆä¸€å®šè¦åœ¨ä¸€ä¸ªé›†åˆå†…å‘¢
			//å¦‚æœä¸åœ¨åŒä¸€ä¸ªé›†åˆå†…ï¼Œå°±æ— æ³•æ­£ç¡®åœ°æ¨¡æ‹Ÿé£Ÿç‰©é“¾çš„å…³ç³»ã€‚å› ä¸ºåœ¨åŒä¸€ä¸ªé›†åˆå†…ï¼Œæ‰èƒ½é€šè¿‡è·ç¦»æ•°ç»„ d æ¥ç»´æŠ¤å…ƒç´ ä¹‹é—´çš„é£Ÿç‰©é“¾å…³ç³»ï¼Œå¹¶æŸ¥é›†æ ¸å¿ƒæ€æƒ³ä¹Ÿæ˜¯è¦åœ¨ä¸€ä¸ªé›†åˆå†… 
			int px = find(x),py = find(y);
			if(t == 1){//æ­¤æ—¶t == 1ï¼Œè¡¨ç¤ºå·²ç»å‘Šè¯‰æˆ‘ä»¬xå’Œyæ˜¯åŒç±» 
				//åœ¨ä¸€ä¸ªæ ‘ä¸Šå¹¶ä¸”xå’Œyä¸æ˜¯åŒç±»å³(d[x] - d[y])%3ä½™1æˆ–ä½™2ï¼Œå‡è¯+1 
				if(px == py && (d[x] - d[y])%3) res++;//æ³¨æ„æ­¤æ—¶å·²ç»ç»è¿‡äº†findå‡½æ•°æ‰€ä»¥d[x]æ˜¯xåˆ°æ ¹èŠ‚ç‚¹çš„è·ç¦» 
				else if(px != py){//å½“xå’Œyä¸åœ¨ä¸€ä¸ªé›†åˆå†…æ—¶æŠŠä»–ä»¬åˆå¹¶ï¼Œæ³¨æ„ifæ¡ä»¶ä¸è¦æ¼ï¼Œä¸è¦ç›´æ¥elseï¼Œæ˜¯åªæœ‰xå’Œyä¸åœ¨ä¸€ä¸ªé›†åˆæ—¶æ‰è¦åˆå¹¶
					p[px] = py;
					d[px] = d[y] - d[x];//1å¼ 
				}
			}
			else{//æ­¤æ—¶å‘Šè¯‰æˆ‘ä»¬xåƒy
				//åœ¨ä¸€ä¸ªæ ‘ä¸Šå¹¶ä¸”xä¸åƒyå³(d[x] - d[y] - 1)%3ä¸ç­‰äº0ï¼Œå‡è¯+1
				if(px == py && (d[x] - d[y] - 1)%3) res++;
				else if(px != py){//å½“xå’Œyä¸åœ¨ä¸€ä¸ªé›†åˆå†…æ—¶æŠŠä»–ä»¬åˆå¹¶ï¼Œæ³¨æ„ifæ¡ä»¶ä¸è¦æ¼ï¼Œä¸è¦ç›´æ¥elseï¼Œæ˜¯åªæœ‰xå’Œyä¸åœ¨ä¸€ä¸ªé›†åˆæ—¶æ‰è¦åˆå¹¶
					p[px] = py;
					d[px] = d[y] +1-d[x];//2å¼ï¼Œ1å¼å’Œ2å¼å…·ä½“æ€è·¯çœ‹å›¾ 
				}
			}
		}
	}
	cout<<res<<endl;
	return 0;
}
```

```c++
//ç®€æ´ç‰ˆ
#include <iostream>

using namespace std;

const int N = 50010;

int p[N],d[N];

int find(int x){
	if(p[x] != x){
		int t= find(p[x]);
		d[x]+=d[p[x]];
		p[x] = t;
	}
	return p[x];
}

int main(){
	int n,m;
	cin>>n>>m;
	for(int i = 1; i <= n ; i++) p[i] = i;
	int res = 0;
	while(m--){
		int op,x,y;
		cin>>op>>x>>y;
		if(x > n ||y > n) res++;
		else{
			int px = find(x),py = find(y);
			if(op == 1){
				if( px == py && (d[x]-d[y])%3) res++;
				else if(px != py){
					p[px] = py;
					d[px] = d[y]-d[x]; 
				}
			}
			else{
				if( px == py && (d[x]-d[y]-1)%3) res++;
				else if(px != py){
					p[px] = py;
					d[px] = d[y]-d[x] + 1; 
				}
			}
		}
	}
	cout<<res<<endl;
	return 0;
}
```

## 10 å †

```c++
//h[N]å­˜å‚¨å †ä¸­çš„å€¼, h[1]æ˜¯å †é¡¶ï¼Œxçš„å·¦å„¿å­æ˜¯2x, å³å„¿å­æ˜¯2x + 1
//phå­˜å‚¨å †ä¸­çš„ä¸‹æ ‡ï¼Œphæ˜¯æ’å…¥é¡ºåºæ•°ç»„ 
//hpå­˜å‚¨å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œhå­˜å‚¨çš„æ˜¯å…ƒç´ çš„å€¼ï¼Œhå’Œhpéƒ½æ˜¯å †æ•°ç»„
//seè¡¨ç¤ºsizeï¼Œæ’å…¥ç‚¹åœ¨å †ä¸­çš„ä¸‹æ ‡ï¼Œå› ä¸ºsizeæ˜¯å…³é”®å­—æ‰€ä»¥ç”¨seä»£æ›¿
int h[N], ph[N], hp[N], se;

void heap_swap(int a, int b){
	//ä¸‹é¢ä¸‰ä¸ªäº¤æ¢åªè¦ä¿è¯ swap(hp[a], hp[b])åœ¨swap(ph[hp[a]], ph[hp[b]])åé¢å°±è¡Œï¼Œå…¶ä»–æ— æ‰€è°“ 
	swap(ph[hp[a]], ph[hp[b]]);//äº¤æ¢å †ä¸­çš„ä¸‹æ ‡
	/*ä¸Šé¢è¿™ä¸€æ­¥æ˜¯äº¤æ¢å †ä¸­çš„ä¸‹æ ‡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥äº¤æ¢aå’Œbï¼šé¦–å…ˆï¼Œæ˜¯å› ä¸ºäº¤æ¢aå’Œbä¼šå½±å“åé¢ä¸¤ä¸ªäº¤æ¢ã€‚
	ä½†æ˜¯è¿™ä¹ˆäº¤æ¢çš„å®é™…æ„æ€æ˜¯ï¼šåªæ˜¯äº¤æ¢äº†phæ•°ç»„ä¸­å¯¹åº”aå’Œbçš„é‚£ä¸ªå€¼ï¼Œæ‰€ä»¥è¿™æ ·æ—¢æ­£ç¡®ä¿®æ”¹äº†æ˜ å°„ï¼Œåˆæ²¡å½±å“åˆ°aå’Œb*/ 
	swap(hp[a], hp[b]);//äº¤æ¢æ’å…¥é¡ºåº 
	swap(h[a], h[b]);//äº¤æ¢å€¼ 
}

void down(int r){
	int t=r;
	if (r * 2 <= se && h[r * 2]< h[t]) t = r * 2;
	if (r *2 + 1 <= se && h[r * 2 + 1]< h[t]) t = r * 2 + 1;
	if (r != t){
		heap_swap(r, t);
		down(t);
	}
}
void up(int u){
	//åªè¦ä¿è¯æ¯”æ ¹ç»“ç‚¹çš„å€¼å¤§å°±è¡Œäº† 
	while (u / 2 && h[u] < h[u / 2]){//æ­¤èŠ‚ç‚¹ç´¢å¼•ä¸ºuï¼Œæ ¹èŠ‚ç‚¹ä¸ºu/2 
		heap_swap(u /2, u);
		u /= 2;//ä¸‹æ¬¡å¾ªç¯å†è·Ÿæ ¹èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹æ¯”...ä»¥æ­¤ç±»æ¨ 
	}
}

// O(n)å»ºå †
for (int i = n / 2; i; i -- ) down(i);
```



### 10.1 å †æ’åº

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/P3378



AcWingé¢˜ç›®ï¼š



![image-20240127094326716](assets/image-20240127094326716.png)

![image-20240127105125952](assets/image-20240127105125952.png)

![image-20240127124022348](assets/image-20240127124022348.png)

```c++

//å°é¡¶å †ï¼š1.æ ¹èŠ‚ç‚¹å°äºç­‰äºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼›2.å‡å¦‚æ ¹èŠ‚ç‚¹çš„ç´¢å¼•ä¸ºxï¼Œåˆ™å·¦å­èŠ‚ç‚¹ç´¢å¼•ä¸º2xï¼Œå³ä¸º2x+1ï¼›3.å †åœ¨å‡ ä½•æ„ä¹‰ä¸Šæ˜¯ä¸€é¢—å®Œå…¨äºŒå‰æ ‘ 

#include<iostream> 
#include<algorithm>

using namespace std;

const int N = 100010;

int h[N], se;//seæ˜¯æ•°ç»„é•¿åº¦size 

int n, m;

void down(int r)
{
    int t = r;
    //ä¸€å®šè¦ç”¨h[t]æ¯”è¾ƒï¼Œå¦‚ä¸Šå›¾
    if (2 * r <= se && h[2 * r] < h[t])//å…ˆè·Ÿå·¦å­èŠ‚ç‚¹æ¯”
        t = 2 * r;
    if (2 * r + 1 <= se && h[2 * r + 1] < h[t])//å†è·Ÿå³å­èŠ‚ç‚¹æ¯”
        t = 2 * r + 1;
    if (r != t)
    {
        swap(h[r], h[t]);//è·Ÿæœ€åæ¯”å‡ºæ¥çš„æœ€å°çš„é‚£ä¸ªç»“ç‚¹æ¢å€¼
        /*ä¸ºä»€ä¹ˆè¦åœ¨if (r != t)é‡Œé¢down(t)ï¼Œè€Œä¸æ˜¯è¿™ä¸ªå‡½æ•°çš„æœ€åæˆ–å…¶ä»–ä½ç½®ï¼šå› ä¸ºå½“r == tæ—¶ï¼Œæ ¹èŠ‚ç‚¹å°±æ˜¯æœ€å°å€¼ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰tæ²¡è¢«èµ‹ç´¢å¼•ï¼›å¦‚æœtè¢«èµ‹ç´¢å¼•äº†ï¼Œæ­¤æ—¶tæ˜¯ä¸¤ä¸ªå­èŠ‚ç‚¹ä¸­æœ€å°çš„é‚£ä¸€ä¸ªï¼Œå› ä¸ºè¿™ä¸ªæœ€å°çš„å€¼è¢«è¿™ä¸ªå°å­æ ‘çš„æ ¹èŠ‚ç‚¹æ¢èµ°äº†ï¼Œæ‰€ä»¥æ­¤æ—¶è¿™ä¸ªå­èŠ‚ç‚¹çš„å€¼å°±æ˜¯æ ¹ç»“ç‚¹çš„å€¼ï¼Œæ˜¯æ¯”åŸæ¥çš„å€¼æ›´å¤§çš„ï¼Œæ‰€ä»¥ä»¥è¿™ä¸ªå­èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å­æ ‘å¯èƒ½å°±ä¸æ»¡è¶³å°é¡¶å †äº†ï¼Œæ‰€ä»¥è¦å†downä¸€ä¸‹ï¼ŒåŒç†ï¼Œåˆ°äº†ä»¥è¿™ä¸ªå­èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹çš„å°å­æ ‘å¦‚æœä¹Ÿæ˜¯è¿™ç§æƒ…å†µä¹Ÿè¦ç»§ç»­å†downï¼Œä»¥æ­¤ç±»æ¨ã€‚*/
        down(t);
    }
}

int main()
{
    cin >> n >> m;
    se = n;
    for (int i = 1; i <= n; i++) cin>>h[i];
    //ä½¿æ•°ç»„æˆä¸ºå †ï¼Œå³åˆå§‹åŒ–å †
    for (int i = n / 2; i > 0; i--) down(i);

    while (m--)
    {
        cout << h[1] << " ";
        h[1] = h[se--];
        down(1);
    }

    return 0;
}
```

### 10.2 æ¨¡æ‹Ÿå †

![image-20240127163204584](assets/image-20240127163204584.png)

```c++
#include<iostream>
#include<algorithm> 

using namespace std;

const int N = 100010;

//phå­˜å‚¨å †ä¸­çš„ä¸‹æ ‡ï¼Œphæ˜¯æ’å…¥é¡ºåºæ•°ç»„ 
//hpå­˜å‚¨å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œhå­˜å‚¨çš„æ˜¯å…ƒç´ çš„å€¼ï¼Œhå’Œhpéƒ½æ˜¯å †æ•°ç»„ 
//seè¡¨ç¤ºsizeï¼Œæ’å…¥ç‚¹åœ¨å †ä¸­çš„ä¸‹æ ‡ 
int h[N], ph[N], hp[N], se;

//å‚æ•°æ˜¯å †ä¸­çš„ä¸‹æ ‡
void heap_swap(int a, int b){
	swap(ph[hp[a]], ph[hp[b]]);//äº¤æ¢å †ä¸­çš„ä¸‹æ ‡
	/*ä¸Šé¢è¿™ä¸€æ­¥æ˜¯äº¤æ¢å †ä¸­çš„ä¸‹æ ‡ï¼Œä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥äº¤æ¢aå’Œbï¼šé¦–å…ˆï¼Œæ˜¯å› ä¸ºäº¤æ¢aå’Œbä¼šå½±å“åé¢ä¸¤ä¸ªäº¤æ¢ã€‚
	ä½†æ˜¯è¿™ä¹ˆäº¤æ¢çš„å®é™…æ„æ€æ˜¯ï¼šåªæ˜¯äº¤æ¢äº†phæ•°ç»„ä¸­å¯¹åº”aå’Œbçš„é‚£ä¸ªå€¼ï¼Œæ‰€ä»¥è¿™æ ·æ—¢æ­£ç¡®ä¿®æ”¹äº†æ˜ å°„ï¼Œåˆæ²¡å½±å“åˆ°aå’Œb*/ 
	swap(hp[a], hp[b]);//äº¤æ¢æ’å…¥é¡ºåº 
	swap(h[a], h[b]);//äº¤æ¢å€¼ 
}

void down(int r){
	int t=r;
	if (r * 2 <= se && h[r * 2]< h[t]) t = r * 2;
	if (r *2 + 1 <= se && h[r * 2 + 1]< h[t]) t = r * 2 + 1;
	if (r != t){
		heap_swap(r, t);
		down(t);
	}
}
void up(int u){
	//åªè¦ä¿è¯æ¯”æ ¹ç»“ç‚¹çš„å€¼å¤§å°±è¡Œäº† 
	while (u / 2 && h[u] < h[u / 2]){//æ­¤èŠ‚ç‚¹ç´¢å¼•ä¸ºuï¼Œæ ¹èŠ‚ç‚¹ä¸ºu/2 
		heap_swap(u /2, u);
		u /= 2;//ä¸‹æ¬¡å¾ªç¯å†è·Ÿæ ¹èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹æ¯”...ä»¥æ­¤ç±»æ¨ 
	}
}

int main(){
	int m;
    cin>>m;
    int n = 0;//nè¡¨ç¤ºæ’å…¥çš„ç¬¬å‡ ä¸ªæ•°     
    while(m--)
    {
        string op;
        int k,x;
        cin>>op;
        //1.æ’å…¥ä¸€ä¸ªæ•°x 
        if(op=="I")
        {
            cin>>x;
            n++;
            se++;//seè¡¨ç¤ºåœ¨å †ä¸­çš„ä¸‹æ ‡ 
            h[se]=x;
            hp[se]=n;
            ph[hp[se]]=se;
            up(se);//æ–°æ’å…¥çš„å€¼æµ®ä¸Šå»ï¼Œæ³¨æ„è¿™ç‚¹æ˜“å¿˜ 
        }
        //2.è¾“å‡ºå½“å‰é›†åˆä¸­çš„æœ€å°å€¼
        else if(op=="PM") cout<<h[1]<<endl;
        //3.åˆ é™¤å½“å‰é›†åˆä¸­çš„æœ€å°å€¼
        else if(op=="DM")
        {
            heap_swap(1,se);//åˆ é™¤æ“ä½œéƒ½æ˜¯é€šè¿‡äº¤æ¢å®ç°ï¼Œåˆ é™¤å®Œè¦è¿›è¡Œæ²‰æˆ–è€…æµ®
            se--;
            down(1);
        }
        //4.åˆ é™¤ç¬¬kä¸ªæ’å…¥çš„æ•° 
        else if(op=="D")
        {
            cin>>k;
            int u = ph[k];
            heap_swap(u,se);//åˆ é™¤æ“ä½œéƒ½æ˜¯é€šè¿‡äº¤æ¢å®ç°ï¼Œåˆ é™¤å®Œè¦è¿›è¡Œæ²‰æˆ–è€…æµ®          
            se--;                    
            up(u);
            down(u);
        }
        //5.ä¿®æ”¹ç¬¬ kä¸ªæ’å…¥çš„æ•°ï¼Œå°†å…¶å˜ä¸º x
        else if(op=="C")
        {
        	//ph[k]è¡¨ç¤ºç¬¬kä¸ªæ•°åœ¨å †ä¸­çš„ä¸‹æ ‡ 
            cin>>k>>x;
            h[ph[k]]=x;                
            down(ph[k]);                
            up(ph[k]);
        }

    }
    return 0;
}
```

```c++
			cin>>k;
            int u = ph[k];
            heap_swap(u,se);       
            se--;                    
            up(u);
            down(u);
			//è¿™é‡Œä¸èƒ½ç”¨ç›´æ¥ç”¨ph[K]ï¼Œphæ•°ç»„åœ¨heap_swapé‡Œæœ‰æ“ä½œï¼Œheap_swapä¹‹åph[k]ä¼šæ”¹å˜ï¼Œè€Œå¦‚æœç”¨å¦ä¸€ä¸ªå˜é‡å…ˆph[k]çš„å€¼å°±ä¸ä¼š
			cin>>k;
            heap_swap(ph[k],se);       
            se--;                    
            up(ph[k]);
            down(ph[k]);
```

## 11 å“ˆå¸Œè¡¨

```c++
æ ¸å¿ƒæ€æƒ³ï¼šå°†å­—ç¬¦ä¸²çœ‹æˆPè¿›åˆ¶æ•°ï¼ŒPçš„ç»éªŒå€¼æ˜¯131æˆ–13331ï¼Œå–è¿™ä¸¤ä¸ªå€¼çš„å†²çªæ¦‚ç‡ä½
å°æŠ€å·§ï¼šå–æ¨¡çš„æ•°ç”¨2^64ï¼Œè¿™æ ·ç›´æ¥ç”¨unsigned long longå­˜å‚¨ï¼Œæº¢å‡ºçš„ç»“æœå°±æ˜¯å–æ¨¡çš„ç»“æœ

typedef unsigned long long ULL;
ULL h[N], p[N]; // h[k]å­˜å‚¨å­—ç¬¦ä¸²å‰kä¸ªå­—æ¯çš„å“ˆå¸Œå€¼, p[k]å­˜å‚¨ P^k mod 2^64

// åˆå§‹åŒ–
p[0] = 1;
for (int i = 1; i <= n; i ++ )
{
    h[i] = h[i - 1] * P + str[i - 1];
    p[i] = p[i - 1] * P;
}

// è®¡ç®—å­ä¸² str[l ~ r] çš„å“ˆå¸Œå€¼
ULL get(int l, int r)
{
    return h[r] - h[l - 1] * p[r - l + 1];
}
```



### 11.1 æ¨¡æ‹Ÿæ•£åˆ—è¡¨

æ´›è°·ï¼šhttps://www.luogu.com.cn/problem/T332544



AcWingé¢˜ç›®ï¼š



![image-20240130095753364](assets/image-20240130095753364.png)

```c++

//æ‹‰é“¾æ³•ï¼Œå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯Nä¸ªå•é“¾è¡¨ï¼Œå°±æ˜¯å¤´ç»“ç‚¹headå˜æˆäº†h[i] 
#include <iostream>
#include <cstring>

using namespace std;

const int N = 100003;  // å–å¤§äº1e5çš„ç¬¬ä¸€ä¸ªè´¨æ•°ï¼Œå–è´¨æ•°å†²çªçš„æ¦‚ç‡æœ€å° å¯ä»¥ç™¾åº¦

//hæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯¹åº”ç´¢å¼•ä¸Šé¢è¿ç€ä¸€ä¸ªé“¾è¡¨ï¼Œh[i]çš„å€¼æ˜¯iç´¢å¼•ä¸Šçš„é“¾è¡¨ä¸­çš„å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆï¼Œå¤´ç»“ç‚¹æ˜¯ç•™ç©ºçš„ï¼› 
int h[N], e[N], ne[N], idx;  

//æ’å…¥çš„æ–¹å¼æ˜¯å¾€å¤´ç»“ç‚¹æ’å…¥ï¼Œå…·ä½“å¯ä»¥çœ‹å•é“¾è¡¨ 
void insert(int x) {
    int k = (x % N + N) % N;//é˜²æ­¢xæ˜¯è´Ÿæ•° 
    e[idx] = x;
    ne[idx] = h[k];
    h[k] = idx++;
}

bool find(int x) {
    int k = (x % N + N) % N;
    for (int i = h[k]; i != -1; i = ne[i]) {
        if (e[i] == x) return true;
    }
    return false;
}


int main() {
	int n; 
    cin >> n;
	memset(h, -1, sizeof h);  //å°†hæ•°ç»„å…¨éƒ¨å…ƒç´ çš„å€¼èµ‹ä¸º-1
    while (n--) {
        string op;
        int x;
        cin >> op >> x;
        if (op == "I") insert(x);
        else {
            if (find(x)) cout<<"Yes"<<endl;
            else cout<<"No"<<endl;
        }
    }
    return 0;
}

```

```c++
//å¼€æ”¾å¯»å€æ³• 

#include <cstring>
#include <iostream>

using namespace std;

//å¼€æ”¾å¯»å€æ³•ä¸€èˆ¬å¼€ æ•°æ®èŒƒå›´çš„ 2~3å€, è¿™æ ·å¤§æ¦‚ç‡å°±æ²¡æœ‰å†²çªäº†
const int N = 200003;        //å¤§äºæ•°æ®èŒƒå›´çš„ç¬¬ä¸€ä¸ªè´¨æ•°
const int null = 0x3f3f3f3f;  //è§„å®šç©ºæŒ‡é’ˆä¸º null 0x3f3f3f3f

int h[N];

//æ’å…¥ä¸æŸ¥æ‰¾åˆä¸ºä¸€ä½“çš„å‡½æ•° 
int find(int x) {
    int k = (x % N + N) % N;
    //h[k] != nullæ˜¯æ’å…¥æ“ä½œçš„æ¡ä»¶ï¼Œh[k] != xæ˜¯æŸ¥æ‰¾æ“ä½œçš„æ¡ä»¶
	//è·³å‡ºå¾ªç¯çš„æ¡ä»¶h[k] == nullæ—¢æ˜¯æ’å…¥ä½ç½®çš„æœ€ç»ˆç»“æœï¼Œä¹Ÿæ˜¯æœªæ‰¾åˆ°å¾…æŸ¥æ‰¾å…ƒç´ çš„æœ€ç»ˆç»“æœ
    //è¿™é‡Œå¯èƒ½ä¼šè€ƒè™‘ç”¨forå¾ªç¯ä»£ç æ›´çŸ­ï¼Œä½†æäº¤å¯èƒ½ä¼šè¶…æ—¶ï¼Œé‡‡ç”¨whileå¾ªç¯ä¼šæ›´å¿«
    while ( h[k] != null && h[k] != x ) {
        k++;
        if (k == N) k = 0;
    }
    return k;  
}



int main() {
	int n; 
    cin >> n;
    
    memset(h, 0x3f, sizeof h);  //è§„å®šç©ºæŒ‡é’ˆä¸º 0x3f3f3f3f

    while (n--) {
        string op;
        int x;
        cin >> op >> x;
        if (op == "I") {
            h[find(x)] = x;
        } else {
            if (h[find(x)] == x) {
                puts("Yes");
            } else {
                puts("No");
            }
        }
    }
    return 0;
}

```

### 11.2 å­—ç¬¦ä¸²å“ˆå¸Œ

![image-20240130153724262](assets/image-20240130153724262.png)

```c++
#include <iostream>

using namespace std;

const int N = 100010,P = 131;//P=131 æˆ– P=13331

typedef unsigned long long ull;//å› ä¸ºQæ˜¯2çš„64æ¬¡æ–¹

char str[N];

//p[i]æ˜¯131çš„iæ¬¡æ–¹ï¼Œä¸»è¦å°±æ˜¯ç”¨åˆ°ä¸€ä¸ªp[r - l + 1]ï¼›h[i]æ˜¯æŒ‡å‰iä¸ªå­—æ¯çš„å“ˆå¸Œå€¼ï¼Œpå’Œhä¸‹æ ‡éƒ½ä»1å¼€å§‹è€ƒè™‘ 
ull h[N],p[N];

ull get(int l,int r){
	return h[r] - h[l - 1] * p[r - l + 1];
}

int main(){
	int n,m;
	cin>>n>>m>>str;
	p[0] = 1;
    //åˆå§‹åŒ–
	for(int i = 1; i <= n; i++){
		p[i] = p[i-1] * P;
		h[i] = h[i-1] * P + str[i - 1];//è®¡ç®—å­—ç¬¦ä¸²å“ˆå¸Œå€¼çš„å…¬å¼
		
	}
	while(m--){
		int l1,r1,l2,r2;
		cin>>l1>>r1>>l2>>r2;
		if(get(l1,r1) == get(l2,r2)) puts("Yes");
		else puts("No");
	}
	return 0;
} 
```

## 12 C++ STLç®€ä»‹

```
vector, å˜é•¿æ•°ç»„ï¼Œå€å¢çš„æ€æƒ³
    size()  è¿”å›å…ƒç´ ä¸ªæ•°
    empty()  è¿”å›æ˜¯å¦ä¸ºç©º
    clear()  æ¸…ç©º
    front()/back()
    push_back()/pop_back()
    begin()/end()
    []
    æ”¯æŒæ¯”è¾ƒè¿ç®—ï¼ŒæŒ‰å­—å…¸åº

pair<int, int>
    first, ç¬¬ä¸€ä¸ªå…ƒç´ 
    second, ç¬¬äºŒä¸ªå…ƒç´ 
    æ”¯æŒæ¯”è¾ƒè¿ç®—ï¼Œä»¥firstä¸ºç¬¬ä¸€å…³é”®å­—ï¼Œä»¥secondä¸ºç¬¬äºŒå…³é”®å­—ï¼ˆå­—å…¸åºï¼‰

stringï¼Œå­—ç¬¦ä¸²
    size()/length()  è¿”å›å­—ç¬¦ä¸²é•¿åº¦
    empty()
    clear()
    substr(èµ·å§‹ä¸‹æ ‡ï¼Œ(å­ä¸²é•¿åº¦))  è¿”å›å­ä¸²
    c_str()  è¿”å›å­—ç¬¦ä¸²æ‰€åœ¨å­—ç¬¦æ•°ç»„çš„èµ·å§‹åœ°å€

queue, é˜Ÿåˆ—
    size()
    empty()
    push()  å‘é˜Ÿå°¾æ’å…¥ä¸€ä¸ªå…ƒç´ 
    front()  è¿”å›é˜Ÿå¤´å…ƒç´ 
    back()  è¿”å›é˜Ÿå°¾å…ƒç´ 
    pop()  å¼¹å‡ºé˜Ÿå¤´å…ƒç´ 

priority_queue, ä¼˜å…ˆé˜Ÿåˆ—ï¼Œé»˜è®¤æ˜¯å¤§æ ¹å †
    size()
    empty()
    push()  æ’å…¥ä¸€ä¸ªå…ƒç´ 
    top()  è¿”å›å †é¡¶å…ƒç´ 
    pop()  å¼¹å‡ºå †é¡¶å…ƒç´ 
    å®šä¹‰æˆå°æ ¹å †çš„æ–¹å¼ï¼špriority_queue<int, vector<int>, greater<int>> q;

stack, æ ˆ
    size()
    empty()
    push()  å‘æ ˆé¡¶æ’å…¥ä¸€ä¸ªå…ƒç´ 
    top()  è¿”å›æ ˆé¡¶å…ƒç´ 
    pop()  å¼¹å‡ºæ ˆé¡¶å…ƒç´ 

deque, åŒç«¯é˜Ÿåˆ—
    size()
    empty()
    clear()
    front()/back()
    push_back()/pop_back()
    push_front()/pop_front()
    begin()/end()
    []

set, map, multiset, multimap, åŸºäºå¹³è¡¡äºŒå‰æ ‘ï¼ˆçº¢é»‘æ ‘ï¼‰ï¼ŒåŠ¨æ€ç»´æŠ¤æœ‰åºåºåˆ—
    size()
    empty()
    clear()
    begin()/end()
    ++, -- è¿”å›å‰é©±å’Œåç»§ï¼Œæ—¶é—´å¤æ‚åº¦ O(logn)

    set/multiset
        insert()  æ’å…¥ä¸€ä¸ªæ•°
        find()  æŸ¥æ‰¾ä¸€ä¸ªæ•°
        count()  è¿”å›æŸä¸€ä¸ªæ•°çš„ä¸ªæ•°
        erase()
            (1) è¾“å…¥æ˜¯ä¸€ä¸ªæ•°xï¼Œåˆ é™¤æ‰€æœ‰x   O(k + logn)
            (2) è¾“å…¥ä¸€ä¸ªè¿­ä»£å™¨ï¼Œåˆ é™¤è¿™ä¸ªè¿­ä»£å™¨
        lower_bound()/upper_bound()
            lower_bound(x)  è¿”å›å¤§äºç­‰äºxçš„æœ€å°çš„æ•°çš„è¿­ä»£å™¨
            upper_bound(x)  è¿”å›å¤§äºxçš„æœ€å°çš„æ•°çš„è¿­ä»£å™¨
    map/multimap
        insert()  æ’å…¥çš„æ•°æ˜¯ä¸€ä¸ªpair
        erase()  è¾“å…¥çš„å‚æ•°æ˜¯pairæˆ–è€…è¿­ä»£å™¨
        find()
        []  æ³¨æ„multimapä¸æ”¯æŒæ­¤æ“ä½œã€‚ æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn)
        lower_bound()/upper_bound()

unordered_set, unordered_map, unordered_multiset, unordered_multimap, å“ˆå¸Œè¡¨
    å’Œä¸Šé¢ç±»ä¼¼ï¼Œå¢åˆ æ”¹æŸ¥çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1)
    ä¸æ”¯æŒ lower_bound()/upper_bound()ï¼Œ è¿­ä»£å™¨çš„++ï¼Œ--

bitset, å‹ä½
    bitset<10000> s;
    ~, &, |, ^
    >>, <<
    ==, !=
    []

    count()  è¿”å›æœ‰å¤šå°‘ä¸ª1

    any()  åˆ¤æ–­æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ª1
    none()  åˆ¤æ–­æ˜¯å¦å…¨ä¸º0

    set()  æŠŠæ‰€æœ‰ä½ç½®æˆ1
    set(k, v)  å°†ç¬¬kä½å˜æˆv
    reset()  æŠŠæ‰€æœ‰ä½å˜æˆ0
    flip()  ç­‰ä»·äº~
    flip(k) æŠŠç¬¬kä½å–å

```

